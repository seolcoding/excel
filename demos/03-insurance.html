<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>4ëŒ€ë³´í—˜ ìë™ê³„ì‚°ê¸°</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    :root{
      --app-max-width: 800px;
      --border-color: #d9dde3;
      --muted: #6c757d;
      --bg-soft: #f8f9fa;
      --focus: rgba(13,110,253,.25);
    }

    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');

    html, body { height: 100%; }
    body{
      font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      background: #fff;
      color: #111;
    }

    .app-wrap{ max-width: var(--app-max-width); margin: 0 auto; }

    .sheet-card{
      border: 1px solid var(--border-color);
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
    }

    .section-title{
      font-weight: 700;
      font-size: 1.05rem;
      margin: 0;
    }

    .help-text{ color: var(--muted); font-size: .92rem; }

    .money{ text-align: right; font-variant-numeric: tabular-nums; white-space: nowrap; }

    .result-table{
      width: 100%;
      border-collapse: collapse;
    }
    .result-table th,
    .result-table td{
      padding: 10px 12px;
      border-bottom: 1px solid var(--border-color);
      vertical-align: middle;
    }
    .result-table th{
      font-weight: 600;
      background: var(--bg-soft);
      width: 55%;
    }
    .result-table tr:last-child th,
    .result-table tr:last-child td{ border-bottom: 0; }

    .total-row th,
    .total-row td{ font-weight: 700; }

    .form-control:focus{
      box-shadow: 0 0 0 .2rem var(--focus);
    }

    .invalid-hint{ display:none; }
    .is-invalid + .invalid-hint{ display:block; }

    /* Print */
    @page {
      size: A4 portrait;
      margin: 25.4mm 19.05mm 25.4mm 19.05mm;
    }

    @media print{
      body{ background: #fff; }
      .no-print{ display: none !important; }
      .sheet-card{ box-shadow: none; }
      a[href]:after{ content: ""; }
      .result-table th,
      .result-table td{ border-bottom: 1px solid #222; }
      .result-table th{ background: #fff; }
      .print-border{
        border: 1px solid #222 !important;
      }
    }
  </style>
</head>

<body>
  <div class="container py-4" x-data="appData()" x-init="init()">
    <div class="app-wrap">
      <header class="mb-3">
        <h1 class="h3 fw-bold mb-1">4ëŒ€ë³´í—˜ ìë™ê³„ì‚°ê¸°</h1>
        <p class="help-text mb-0">ì›” ê¸‰ì—¬(ê³¼ì„¸)ë¥¼ ì…ë ¥í•˜ë©´ ê°œì¸ ë¶€ë‹´ ê¸°ì¤€ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.</p>
      </header>

      <main class="sheet-card p-3 p-md-4">
        <!-- ì…ë ¥ ì„¹ì…˜ -->
        <section aria-labelledby="sec-input" class="mb-4">
          <div class="d-flex align-items-center justify-content-between gap-3 mb-2">
            <h2 id="sec-input" class="section-title">ê¸‰ì—¬ ì…ë ¥</h2>
            <div class="no-print d-flex gap-2">
              <button type="button" class="btn btn-primary" @click="calculateFourInsurance()">ê³„ì‚°</button>
              <button type="button" class="btn btn-outline-secondary" @click="resetAll()">ì´ˆê¸°í™”</button>
              <button type="button" class="btn btn-outline-dark" @click="print()">ì¸ì‡„</button>
            </div>
          </div>

          <form class="row g-3" @submit.prevent="calculateFourInsurance()" novalidate>
            <div class="col-12 col-md-8">
              <label for="monthly_salary_taxable" class="form-label fw-semibold">ì›” ê¸‰ì—¬(ê³¼ì„¸)</label>
              <input
                id="monthly_salary_taxable"
                name="monthly_salary_taxable"
                class="form-control"
                :class="{ 'is-invalid': !!errors.monthly_salary_taxable }"
                type="number"
                inputmode="decimal"
                step="any"
                min="0"
                autocomplete="off"
                x-model="monthly_salary_taxable"
                @input="onSalaryInput($event)"
                aria-describedby="salaryHelp salaryError"
              />
              <div id="salaryHelp" class="form-text help-text">ì˜ˆ: 3000000 (ìˆ«ìë§Œ ì…ë ¥)</div>
              <div id="salaryError" class="invalid-hint text-danger mt-1" role="alert" x-text="errors.monthly_salary_taxable"></div>
            </div>
            <div class="col-12 col-md-4 d-flex align-items-end">
              <div class="w-100 p-3 rounded-3" style="background: var(--bg-soft); border: 1px solid var(--border-color);">
                <div class="small text-muted">ì…ë ¥ ê¸‰ì—¬(í‘œì‹œ)</div>
                <div class="h5 mb-0 money" x-text="formatKRW(roundPolicy(salaryNumber), 0)"></div>
              </div>
            </div>
          </form>
        </section>

        <!-- ê²°ê³¼ ì„¹ì…˜ -->
        <section aria-labelledby="sec-result" class="print-border rounded-3" style="border: 1px solid var(--border-color);">
          <div class="p-3 border-bottom" style="border-color: var(--border-color) !important;">
            <h2 id="sec-result" class="section-title mb-0">4ëŒ€ ë³´í—˜ ê³„ì‚° ê²°ê³¼</h2>
          </div>

          <div class="p-0">
            <table class="result-table" aria-label="4ëŒ€ ë³´í—˜ ê³„ì‚° ê²°ê³¼ í‘œ">
              <tbody>
                <tr>
                  <th scope="row">êµ­ë¯¼ì—°ê¸ˆ(ê°œì¸)</th>
                  <td class="money" aria-live="polite" x-text="formatKRW(roundPolicy(national_pension_employee), 0)"></td>
                </tr>
                <tr>
                  <th scope="row">ê±´ê°•ë³´í—˜(ê°œì¸)</th>
                  <td class="money" aria-live="polite" x-text="formatKRW(roundPolicy(health_insurance_employee), 0)"></td>
                </tr>
                <tr>
                  <th scope="row">ì¥ê¸°ìš”ì–‘ë³´í—˜(ê°œì¸)</th>
                  <td class="money" aria-live="polite" x-text="formatKRW(roundPolicy(long_term_care_employee), 0)"></td>
                </tr>
                <tr>
                  <th scope="row">ê³ ìš©ë³´í—˜(ê°œì¸)</th>
                  <td class="money" aria-live="polite" x-text="formatKRW(roundPolicy(employment_insurance_employee), 0)"></td>
                </tr>
                <tr class="total-row">
                  <th scope="row">4ëŒ€ ë³´í—˜ í•©ê³„(ê°œì¸)</th>
                  <td class="money" aria-live="polite" x-text="formatKRW(roundPolicy(four_insurance_total_employee), 0)"></td>
                </tr>
                <tr>
                  <th scope="row">ë³´í—˜ ê³µì œ í›„ ê¸ˆì•¡(ì°¸ê³ )</th>
                  <td class="money" aria-live="polite" x-text="formatKRW(roundPolicy(net_after_insurance_only), 0)"></td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="p-3">
            <p class="help-text mb-0">ì°¸ê³ : ë³¸ ê³„ì‚°ê¸°ëŠ” ì…ë ¥ ê¸‰ì—¬ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•œ ë‹¨ìˆœ ë¹„ìœ¨ ê³„ì‚°ì´ë©°, ì‹¤ì œ ê³ ì§€/ì •ì‚°ê³¼ ì°¨ì´ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
        </section>

        <div class="no-print mt-3">
          <details>
            <summary class="text-muted">ê³„ì‚°ì‹(ì—‘ì…€) ë³´ê¸°</summary>
            <div class="mt-2 small text-muted" style="line-height: 1.6;">
              <div>C4 = C3 * 0.045</div>
              <div>C5 = C3 * 0.03545</div>
              <div>C6 = C5 * 0.1281</div>
              <div>C7 = C3 * 0.009</div>
              <div>C8 = C4 + C5 + C6 + C7</div>
              <div>C9 = C3 - C8</div>
            </div>
          </details>
        </div>
      </main>
    </div>
  </div>

  <script>
    // Excel formula helper functions
    function _sum(...args) {
        return args.flat().reduce((a, b) => (parseFloat(a) || 0) + (parseFloat(b) || 0), 0);
    }

    function _sumRange(rangeData) {
        if (Array.isArray(rangeData)) {
            return rangeData.flat().reduce((a, b) => (parseFloat(a) || 0) + (parseFloat(b) || 0), 0);
        }
        return parseFloat(rangeData) || 0;
    }

    function _average(...args) {
        const flat = args.flat().filter(x => x !== null && x !== '' && !isNaN(x));
        return flat.length ? _sum(...flat) / flat.length : 0;
    }

    function _averageRange(rangeData) {
        if (Array.isArray(rangeData)) {
            const flat = rangeData.flat().filter(x => x !== null && x !== '' && !isNaN(x));
            return flat.length ? _sumRange(flat) / flat.length : 0;
        }
        return parseFloat(rangeData) || 0;
    }

    function _count(...args) {
        return args.flat().filter(x => typeof x === 'number' && !isNaN(x)).length;
    }

    function _counta(...args) {
        return args.flat().filter(x => x !== null && x !== '' && x !== undefined).length;
    }

    function _and(...args) {
        return args.every(x => Boolean(x));
    }

    function _or(...args) {
        return args.some(x => Boolean(x));
    }

    function _round(num, digits = 0) {
        const factor = Math.pow(10, digits);
        return Math.round(num * factor) / factor;
    }

    function _roundUp(num, digits = 0) {
        const factor = Math.pow(10, digits);
        return Math.ceil(num * factor) / factor;
    }

    function _roundDown(num, digits = 0) {
        const factor = Math.pow(10, digits);
        return Math.floor(num * factor) / factor;
    }

    function _len(text) {
        return String(text).length;
    }

    function _left(text, numChars = 1) {
        return String(text).substring(0, numChars);
    }

    function _right(text, numChars = 1) {
        const str = String(text);
        return str.substring(str.length - numChars);
    }

    function _mid(text, startNum, numChars) {
        return String(text).substring(startNum - 1, startNum - 1 + numChars);
    }

    function _trim(text) {
        return String(text).trim();
    }

    function _upper(text) {
        return String(text).toUpperCase();
    }

    function _lower(text) {
        return String(text).toLowerCase();
    }

    function _concat(...args) {
        return args.join('');
    }

    // Number formatting
    function formatNumber(num, decimals = 0) {
        return new Intl.NumberFormat('ko-KR', {
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals
        }).format(num);
    }

    function formatCurrency(num) {
        return new Intl.NumberFormat('ko-KR', {
            style: 'currency',
            currency: 'KRW',
            maximumFractionDigits: 0
        }).format(num);
    }

    function formatPercent(num, decimals = 1) {
        return new Intl.NumberFormat('ko-KR', {
            style: 'percent',
            minimumFractionDigits: decimals,
            maximumFractionDigits: decimals
        }).format(num / 100);
    }

    function appData(){
      return {
        // Input (C3)
        monthly_salary_taxable: 0,

        // Internal numeric parsed value
        salaryNumber: 0,

        // Outputs (C4~C9)
        national_pension_employee: 0,
        health_insurance_employee: 0,
        long_term_care_employee: 0,
        employment_insurance_employee: 0,
        four_insurance_total_employee: 0,
        net_after_insurance_only: 0,

        errors: {
          monthly_salary_taxable: ''
        },

        _debounceTimer: null,

        init(){
          this.calculateFourInsurance();
        },

        // ì›í™” í¬ë§·
        formatKRW(value, fractionDigits = 0){
          const n = Number(value);
          const safe = Number.isFinite(n) ? n : 0;
          return new Intl.NumberFormat('ko-KR', {
            style: 'currency',
            currency: 'KRW',
            minimumFractionDigits: fractionDigits,
            maximumFractionDigits: fractionDigits
          }).format(safe);
        },

        // ì—‘ì…€ í‘œì‹œ(ê¸°ë³¸: ì› ë‹¨ìœ„ ë°˜ì˜¬ë¦¼)
        roundPolicy(value){
          const n = Number(value);
          if(!Number.isFinite(n)) return 0;
          return Math.round(n); // ê¸°ë³¸: ì› ë‹¨ìœ„ ë°˜ì˜¬ë¦¼
        },

        validateSalary(){
          const raw = this.monthly_salary_taxable;

          if (raw === '' || raw === null || typeof raw === 'undefined') {
            this.errors.monthly_salary_taxable = 'ì›” ê¸‰ì—¬(ê³¼ì„¸)ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
            return null;
          }

          const num = Number(raw);
          if (!Number.isFinite(num) || Number.isNaN(num)) {
            this.errors.monthly_salary_taxable = 'ìˆ«ì í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
            return null;
          }
          if (num < 0) {
            this.errors.monthly_salary_taxable = 'ìŒìˆ˜ëŠ” ì…ë ¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
            return null;
          }

          this.errors.monthly_salary_taxable = '';
          return num;
        },

        onSalaryInput(){
          clearTimeout(this._debounceTimer);
          this._debounceTimer = setTimeout(() => {
            this.calculateFourInsurance();
          }, 150);
        },

        // Main calculation (C4~C9)
        calculateFourInsurance(){
          const salary = this.validateSalary();
          if (salary === null) {
            // invalid: keep outputs at 0 (avoid stale misleading numbers)
            this.salaryNumber = 0;
            this.national_pension_employee = 0;
            this.health_insurance_employee = 0;
            this.long_term_care_employee = 0;
            this.employment_insurance_employee = 0;
            this.four_insurance_total_employee = 0;
            this.net_after_insurance_only = 0;
            return;
          }

          this.salaryNumber = salary;

          // Use converted Excel formulas
          const data = {
            C3: salary,
            C4: 0,
            C5: 0,
            C6: 0,
            C7: 0,
            C8: 0
          };

          // C4: =C3*0.045
          data.C4 = data['C3']*0.045;
          // C5: =C3*0.03545
          data.C5 = data['C3']*0.03545;
          // C6: =C5*0.1281
          data.C6 = data['C5']*0.1281;
          // C7: =C3*0.009
          data.C7 = data['C3']*0.009;
          // C8: =C4+C5+C6+C7
          data.C8 = data['C4']+data['C5']+data['C6']+data['C7'];
          // C9: =C3-C8
          const c9 = data['C3']-data['C8'];

          // Bind outputs
          this.national_pension_employee = data.C4;
          this.health_insurance_employee = data.C5;
          this.long_term_care_employee = data.C6;
          this.employment_insurance_employee = data.C7;
          this.four_insurance_total_employee = data.C8;
          this.net_after_insurance_only = c9;
        },

        resetAll(){
          this.monthly_salary_taxable = 0;
          this.errors.monthly_salary_taxable = '';
          this.calculateFourInsurance();
          const el = document.getElementById('monthly_salary_taxable');
          if (el) el.focus();
        },

        print(){
          window.print();
        }
      }
    }
  </script>

<!-- í•´ì»¤í†¤ ì„ ì • ì •ë³´ -->
<div id="selection-banner" style="
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 12px 20px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    font-size: 14px;
    z-index: 10000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
">
    <div>
        <strong>ğŸ“Š 4ëŒ€ë³´í—˜ ìë™ê³„ì‚°ê¸°</strong>
        <span style="margin-left: 10px; opacity: 0.9;">| ë³´í—˜/ê¸‰ì—¬</span>
    </div>
    <div style="display: flex; align-items: center; gap: 15px;">
        <span style="background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 12px; font-size: 12px;">
            6ê°œ ìˆ˜ì‹
        </span>
        <button onclick="document.getElementById('selection-info').style.display='block'"
                style="background: white; color: #667eea; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-weight: 500;">
            ì„ ì • ì´ìœ  ë³´ê¸°
        </button>
    </div>
</div>

<div id="selection-info" style="
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 10001;
    display: none;
    justify-content: center;
    align-items: center;
" onclick="this.style.display='none'">
    <div style="
        background: white;
        padding: 30px;
        border-radius: 16px;
        max-width: 500px;
        margin: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    " onclick="event.stopPropagation()">
        <h2 style="margin: 0 0 15px; color: #333;">ğŸ† í•´ì»¤í†¤ ì„ ì • ì´ìœ </h2>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
            <strong style="color: #667eea;">ë³´í—˜/ê¸‰ì—¬</strong>
            <p style="margin: 10px 0 0; color: #555; line-height: 1.6;">4ëŒ€ë³´í—˜ ìë™ ê³„ì‚° - HR ë„ë©”ì¸ ì‹¤ìš©ì„±</p>
        </div>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <span style="background: #e3e8ff; color: #4c5fd5; padding: 4px 10px; border-radius: 12px; font-size: 12px;">ìë™ê³„ì‚°</span>
        </div>
        <button onclick="document.getElementById('selection-info').style.display='none'"
                style="margin-top: 20px; width: 100%; padding: 12px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">
            ë‹«ê¸°
        </button>
    </div>
</div>

<style>
body { padding-top: 56px !important; }
</style>
</body>
</html>
